{"version":3,"file":"create_template.min.js","sources":["../src/create_template.js"],"sourcesContent":["define(['jquery', \"core/ajax\"], function($) {\n    return {\n        init: function() {\n            const formElements = $('.mform input, .mform select, mform textarea');\n            const form = $('.mform');\n            const saveButton = form.find('#id_save_template_button'); // Update this to the correct ID\n\n            // Get the current URL, including query parameters\n            // const currentUrlWithParams = window.location.href;\n\n            // Iterate over each form element to add an event listener for changes.\n            formElements.each(function() {\n                const element = $(this);\n                element.on('change', function() {\n                    markTouched(element);\n                });\n\n                if (element.is(':checkbox') || element.is(':radio')) {\n                    element.on('click', function() {\n                        markTouched(element);\n                    });\n                }\n            });\n\n            /**\n             * Get query parameters from the current URL.\n             * @returns {Object} An object containing the query parameters.\n             * @example\n             * getQueryParams(); // returns {categoryid: 1, courseid: 2}\n             */\n            function getQueryParams() {\n                const params = {};\n                const urlSearchParams = new URLSearchParams(window.location.search);\n                urlSearchParams.forEach((value, key) => {\n                    params[key] = value;\n                });\n                return params;\n            }\n\n            form.on('submit', function(e) {\n                e.preventDefault();\n            });\n\n            saveButton.on('click', function(e) {\n                e.preventDefault();\n                console.log(\"Custom save button clicked. Default form submission prevented.\");\n                let formData = {};\n\n                // Gather only touched elements\n                formElements.each(function() {\n                    const element = $(this);\n                    if (element.attr('data-touched') === 'true') {\n                        const htmlId = element.attr('id');\n                        const settingName = htmlId.replace('id_', ''); // Derive the setting name by removing 'id_'\n                        formData[settingName] = element.val();\n                    }\n                });\n\n                // Add template_name and any other essential values\n                formData['template_name'] = form.find('input[name=\"template_name\"]').val();\n\n                // Append query parameters (like categoryid, courseid, etc.)\n                const queryParams = getQueryParams();\n                formData = {...formData, ...queryParams};\n\n                // Submit the form data using AJAX\n                $.ajax({\n                    url: '/moodle/local/setcheck/pages/create_template.php',\n                    method: 'POST',\n                    data: formData,\n                    success: function(response) {\n                        // Handle success response\n                        const responseData = JSON.parse(response);\n                        if (responseData.redirect) {\n                            window.location.href = responseData.redirect;\n                        } else if (responseData.error) {\n                            console.error(responseData.error);\n                        }\n                    },\n                    error: function(xhr, status, error) {\n                        console.error('An error occurred:', error);\n                    }\n                });\n            });\n\n            /**\n             * @param {jQuery} element The element to mark as touched.\n             */\n            function markTouched(element) {\n                element.attr('data-touched', 'true');\n            }\n        }\n    };\n});"],"names":["define","$","init","formElements","form","saveButton","find","markTouched","element","attr","each","this","on","is","e","preventDefault","console","log","formData","settingName","replace","val","queryParams","params","URLSearchParams","window","location","search","forEach","value","key","getQueryParams","ajax","url","method","data","success","response","responseData","JSON","parse","redirect","href","error","xhr","status"],"mappings":"AAAAA,wCAAO,CAAC,SAAU,cAAc,SAASC,SAC9B,CACHC,KAAM,iBACIC,aAAeF,EAAE,+CACjBG,KAAOH,EAAE,UACTI,WAAaD,KAAKE,KAAK,qCAmFpBC,YAAYC,SACjBA,QAAQC,KAAK,eAAgB,QA9EjCN,aAAaO,MAAK,iBACRF,QAAUP,EAAEU,MAClBH,QAAQI,GAAG,UAAU,WACjBL,YAAYC,aAGZA,QAAQK,GAAG,cAAgBL,QAAQK,GAAG,YACtCL,QAAQI,GAAG,SAAS,WAChBL,YAAYC,eAoBxBJ,KAAKQ,GAAG,UAAU,SAASE,GACvBA,EAAEC,oBAGNV,WAAWO,GAAG,SAAS,SAASE,GAC5BA,EAAEC,iBACFC,QAAQC,IAAI,sEACRC,SAAW,GAGff,aAAaO,MAAK,iBACRF,QAAUP,EAAEU,SACmB,SAAjCH,QAAQC,KAAK,gBAA4B,OAEnCU,YADSX,QAAQC,KAAK,MACDW,QAAQ,MAAO,IAC1CF,SAASC,aAAeX,QAAQa,UAKxCH,SAAQ,cAAoBd,KAAKE,KAAK,+BAA+Be,YAG/DC,6BA/BAC,OAAS,UACS,IAAIC,gBAAgBC,OAAOC,SAASC,QAC5CC,SAAQ,CAACC,MAAOC,OAC5BP,OAAOO,KAAOD,SAEXN,OA0BaQ,GACpBb,SAAW,IAAIA,YAAaI,aAG5BrB,EAAE+B,KAAK,CACHC,IAAK,mDACLC,OAAQ,OACRC,KAAMjB,SACNkB,QAAS,SAASC,gBAERC,aAAeC,KAAKC,MAAMH,UAC5BC,aAAaG,SACbhB,OAAOC,SAASgB,KAAOJ,aAAaG,SAC7BH,aAAaK,OACpB3B,QAAQ2B,MAAML,aAAaK,QAGnCA,MAAO,SAASC,IAAKC,OAAQF,OACzB3B,QAAQ2B,MAAM,qBAAsBA"}