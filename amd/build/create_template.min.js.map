{"version":3,"file":"create_template.min.js","sources":["../src/create_template.js"],"sourcesContent":["define(['jquery', \"core/ajax\"], function($) {\n    return {\n        init: function() {\n            const formElements = $('#create_template_form input, #create_template_form select, #create_template_form textarea');\n            const form = $('#create_template_form');\n            const saveButton = form.find('#id_save_template_button'); // Update this to the correct ID\n            const cancelButton = form.find('#id_cancel_template_button'); // Cancel button\n\n            // Iterate over each form element to add an event listener for changes.\n            formElements.each(function() {\n                const element = $(this);\n                element.on('change', function() {\n                    markTouched(element);\n                });\n\n                if (element.is(':checkbox') || element.is(':radio')) {\n                    element.on('click', function() {\n                        markTouched(element);\n                    });\n                }\n            });\n\n            // Handle save button click (prevent the default form submission).\n            saveButton.on('click', function(event) {\n                event.preventDefault(); // Prevent the default form submission\n\n                // Gather only touched elements\n                let formData = {};\n                formElements.each(function() {\n                    const element = $(this);\n                    if (element.attr('data-touched') === 'true') {\n                        const htmlId = element.attr('id');\n                        const settingName = htmlId.replace('id_', ''); // Derive the setting name by removing 'id_'\n                        formData[settingName] = element.val();\n                    }\n                });\n\n                // Also add template_name and any other essential values\n                formData['template_name'] = form.find('input[name=\"template_name\"]').val();\n\n                // Submit the form data using AJAX\n                $.ajax({\n                    url: form.attr('action'),\n                    method: 'POST',\n                    data: formData,\n                    success: function(response) {\n                        try {\n                            const responseData = JSON.parse(response);\n                            if (responseData.redirect) {\n                                // Redirect to the specified URL, generated by Moodle\n                                window.location.href = responseData.redirect;\n                            } else if (responseData.error) {\n                                console.error(responseData.error);\n                            }\n                        } catch (e) {\n                            console.error('Error parsing JSON response:', e);\n                            console.error('Response received:', response);\n                        }\n                    },\n                    error: function(xhr, status, error) {\n                        console.log('An error occurred while saving the template.');\n                        console.log('Status:', status);\n                        console.log('Error:', error);\n                        console.log('Response:', xhr.responseText);\n                    }\n                });\n            });\n\n            // Handle cancel button click.\n            cancelButton.on('click', function(event) {\n                event.preventDefault(); // Prevent the default action\n                window.location.href = M.cfg.wwwroot + '/local/setcheck/manage_templates.php';\n            });\n\n            /**\n             * @param {jQuery} element The element to mark as touched.\n             */\n            function markTouched(element) {\n                element.attr('data-touched', 'true');\n            }\n        }\n    };\n});\n"],"names":["define","$","init","formElements","form","saveButton","find","cancelButton","markTouched","element","attr","each","this","on","is","event","preventDefault","formData","settingName","replace","val","ajax","url","method","data","success","response","responseData","JSON","parse","redirect","window","location","href","error","console","e","xhr","status","log","responseText","M","cfg","wwwroot"],"mappings":"AAAAA,wCAAO,CAAC,SAAU,cAAc,SAASC,SAC9B,CACHC,KAAM,iBACIC,aAAeF,EAAE,6FACjBG,KAAOH,EAAE,yBACTI,WAAaD,KAAKE,KAAK,4BACvBC,aAAeH,KAAKE,KAAK,uCAuEtBE,YAAYC,SACjBA,QAAQC,KAAK,eAAgB,QArEjCP,aAAaQ,MAAK,iBACRF,QAAUR,EAAEW,MAClBH,QAAQI,GAAG,UAAU,WACjBL,YAAYC,aAGZA,QAAQK,GAAG,cAAgBL,QAAQK,GAAG,YACtCL,QAAQI,GAAG,SAAS,WAChBL,YAAYC,eAMxBJ,WAAWQ,GAAG,SAAS,SAASE,OAC5BA,MAAMC,qBAGFC,SAAW,GACfd,aAAaQ,MAAK,iBACRF,QAAUR,EAAEW,SACmB,SAAjCH,QAAQC,KAAK,gBAA4B,OAEnCQ,YADST,QAAQC,KAAK,MACDS,QAAQ,MAAO,IAC1CF,SAASC,aAAeT,QAAQW,UAKxCH,SAAQ,cAAoBb,KAAKE,KAAK,+BAA+Bc,MAGrEnB,EAAEoB,KAAK,CACHC,IAAKlB,KAAKM,KAAK,UACfa,OAAQ,OACRC,KAAMP,SACNQ,QAAS,SAASC,oBAEJC,aAAeC,KAAKC,MAAMH,UAC5BC,aAAaG,SAEbC,OAAOC,SAASC,KAAON,aAAaG,SAC7BH,aAAaO,OACpBC,QAAQD,MAAMP,aAAaO,OAEjC,MAAOE,GACLD,QAAQD,MAAM,+BAAgCE,GAC9CD,QAAQD,MAAM,qBAAsBR,YAG5CQ,MAAO,SAASG,IAAKC,OAAQJ,OACzBC,QAAQI,IAAI,gDACZJ,QAAQI,IAAI,UAAWD,QACvBH,QAAQI,IAAI,SAAUL,OACtBC,QAAQI,IAAI,YAAaF,IAAIG,oBAMzCjC,aAAaM,GAAG,SAAS,SAASE,OAC9BA,MAAMC,iBACNe,OAAOC,SAASC,KAAOQ,EAAEC,IAAIC,QAAU"}