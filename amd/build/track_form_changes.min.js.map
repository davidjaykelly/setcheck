{"version":3,"file":"track_form_changes.min.js","sources":["../src/track_form_changes.js"],"sourcesContent":["define(['jquery', \"core/ajax\"], function($) {\n    return {\n        init: function() {\n            const formElements = $('#create_template_form input, #create_template_form select, #create_template_form textarea');\n            const form = $('#create_template_form');\n            const submitButton = form.find('button[name=\"save_template_button\"]');\n\n            // Iterate over each form element to add an event listener for changes.\n            formElements.each(function() {\n                const element = $(this);\n                element.on('change', function() {\n                    markTouched(element);\n                });\n\n                if (element.is(':checkbox') || element.is(':radio')) {\n                    element.on('click', function() {\n                        markTouched(element);\n                    });\n                }\n            });\n\n            // Handle form submission\n            submitButton.on('click', function(event) {\n                event.preventDefault(); // Prevent the default form submission\n\n                // Gather only touched elements\n                let formData = {};\n                formElements.each(function() {\n                    const element = $(this);\n                    if (element.attr('data-touched') === 'true') {\n                        const htmlId = element.attr('id');\n                        const settingName = htmlId.replace('id_', ''); // Derive the setting name by removing 'id_'\n                        formData[settingName] = element.val();\n                    }\n                });\n\n                // Also add template_name and any other essential values\n                formData['template_name'] = form.find('input[name=\"template_name\"]').val();\n                console.log(formData);\n\n                // Submit the form data using AJAX\n                $.ajax({\n                    url: form.attr('action'),\n                    method: 'POST',\n                    data: formData,\n                    success: function(response) {\n                        try {\n                            const responseData = JSON.parse(response);\n                            if (responseData.redirect) {\n                                // Redirect to the specified URL, generated by Moodle\n                                window.location.href = responseData.redirect;\n                            } else if (responseData.error) {\n                                console.error(responseData.error);\n                            }\n                        } catch (e) {\n                            console.error('Error parsing JSON response:', e);\n                            console.error('Response received:', response);\n                        }\n                    },\n                    error: function(xhr, status, error) {\n                        console.log('An error occurred while saving the template.');\n                        console.log('Status:', status);\n                        console.log('Error:', error);\n                        console.log('Response:', xhr.responseText);\n                    }\n                });\n            });\n\n            /**\n            * @param {jQuery} element The element to mark as touched.\n            */\n            function markTouched(element) {\n                element.attr('data-touched', 'true');\n            }\n        }\n    };\n});\n"],"names":["define","$","init","formElements","form","submitButton","find","markTouched","element","attr","each","this","on","is","event","preventDefault","formData","settingName","replace","val","console","log","ajax","url","method","data","success","response","responseData","JSON","parse","redirect","window","location","href","error","e","xhr","status","responseText"],"mappings":"AAAAA,2CAAO,CAAC,SAAU,cAAc,SAASC,SAC9B,CACHC,KAAM,iBACIC,aAAeF,EAAE,6FACjBG,KAAOH,EAAE,yBACTI,aAAeD,KAAKE,KAAK,gDAkEtBC,YAAYC,SACjBA,QAAQC,KAAK,eAAgB,QAhEjCN,aAAaO,MAAK,iBACRF,QAAUP,EAAEU,MAClBH,QAAQI,GAAG,UAAU,WACjBL,YAAYC,aAGZA,QAAQK,GAAG,cAAgBL,QAAQK,GAAG,YACtCL,QAAQI,GAAG,SAAS,WAChBL,YAAYC,eAMxBH,aAAaO,GAAG,SAAS,SAASE,OAC9BA,MAAMC,qBAGFC,SAAW,GACfb,aAAaO,MAAK,iBACRF,QAAUP,EAAEU,SACmB,SAAjCH,QAAQC,KAAK,gBAA4B,OAEnCQ,YADST,QAAQC,KAAK,MACDS,QAAQ,MAAO,IAC1CF,SAASC,aAAeT,QAAQW,UAKxCH,SAAQ,cAAoBZ,KAAKE,KAAK,+BAA+Ba,MACrEC,QAAQC,IAAIL,UAGZf,EAAEqB,KAAK,CACHC,IAAKnB,KAAKK,KAAK,UACfe,OAAQ,OACRC,KAAMT,SACNU,QAAS,SAASC,oBAEJC,aAAeC,KAAKC,MAAMH,UAC5BC,aAAaG,SAEbC,OAAOC,SAASC,KAAON,aAAaG,SAC7BH,aAAaO,OACpBf,QAAQe,MAAMP,aAAaO,OAEjC,MAAOC,GACLhB,QAAQe,MAAM,+BAAgCC,GAC9ChB,QAAQe,MAAM,qBAAsBR,YAG5CQ,MAAO,SAASE,IAAKC,OAAQH,OACzBf,QAAQC,IAAI,gDACZD,QAAQC,IAAI,UAAWiB,QACvBlB,QAAQC,IAAI,SAAUc,OACtBf,QAAQC,IAAI,YAAagB,IAAIE"}